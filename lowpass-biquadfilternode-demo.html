<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="description" content="jazzomatic is a program to create awsome jazz jams.">
        <meta name="viewport" content="width=device-width, user-scalable=yes, initial-scale=1, maximum-scale=1">
        <meta id="theme-color" name="theme-color" content="#ffffff">
        <link rel="icon" sizes="192x192" href="static/icon-192x192.png">
        <title>jazzomatic</title>
        <style>
        </style>
    </head>
    <body>

        <main id="container">
            <audio id="on-speaker" crossorigin="anonymous">
                <source src="../static/tracks/track%203.mp3" type="audio/mp3"></source>
                <source src="../static/tracks/example.ogg" type="audio/ogg"></source> <!-- this file works as feedback to the developer whenver MP3 is not supported in the browser. -->
            </audio>
            <video id="on-screen" controls playsinline poster="static/poster.jpg">
                Sorry. Your browser doesn't support videos.
            </video>
            <div class="parameter">
                <label>frequency</label><span id="frequency"></span>
            </div>
            <div class="parameter">
                <label>detune</label><span id="detune"></span>
            </div>
            <div class="parameter">
                <label>Q</label><span id="Q"></span>
            </div>
            <div class="parameter">
                <label>gain</label><span id="gain"></span>
            </div>
            <div id="error-box" class="tooltip hidden"></div>
            <script>
            "use strict";
            const globals = {
              audioCtx: null
            };

            function wireAudioContext(element) {
                var audioCtx = new AudioContext();
                var biquadFilter = audioCtx.createBiquadFilter();
                biquadFilter.type = "lowpass";
                var source = audioCtx.createElementSource(element);
                source.connect(biquadFilter);
                biquadFilter.connect(audioCtx.destination);

                globals.audioCtx = audioCtx;
            }

            function wireParameters() {
                document.getElementById("Q").innerText = globals.audioCtx.Q;
                document.getElementById("frequency").innerText = globals.audioCtx.frequency;
                document.getElementById("detune").innerText = globals.audioCtx.detune;
                document.getElementById("gain").innerText = globals.audioCtx.gain;
            }

            function wireMediaControls() {
                document.getElementById("on-screen").addEventListener("pause", stopTrack);
                document.getElementById("on-screen").addEventListener("play", playTrack);
            }

            function stopTrack() {
                document.getElementById("on-speaker").pause();
            }

            function playTrack() {
                const videoOnScreen = document.getElementById("on-screen");
                videoOnScreen.removeAttribute("poster");
                const onSpeaker = document.getElementById("on-speaker");


                onSpeaker.play();

            }

            function main() {
                wireMediaControls();
                var audio = document.getElementById("on-speaker");
                wireAudioContext();
                wireParameters();
            }

            main();
          </script>
        </main>
    </body>
</html>
